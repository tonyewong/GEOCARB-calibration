par(mfrow=c(2,1), mai=c(.8, 1.2, .2,.2))
plot(-age, log10(model_co2$ctrl[,1]), type='l', lwd=2, xlim=c(-420,0), ylim=log10(c(2, 50000)), xaxt='n', xlab='', yaxt='n', ylab='')
lines(-age, log10(windows$co2[,1]), lwd=2, col='firebrick'); lines(-age, log10(windows$co2[,2]), lwd=2, col='firebrick')
lines(-age, log10(model_co2$ctrl[,1]), type='l', lwd=2)
axis(side=1, at=seq(-450, 0, by=50), labels=c('','400','','300','','200','','100','','0'), cex.axis=1.2)
axis(side=2, at=log10(c(3,10,30,100,300,1000,3000,10000,30000)), labels=c(3,10,30,100,300,1000,3000,10000,30000), cex.axis=1.2, las=1)
mtext(side=1, text="Time [Myr ago]", cex=1.2, line=2.2)
mtext(side=2, text="CO2 concentration [ppmv]", cex=1.2, line=4.5)



idx_no_data <- which(windows$co2[,"low"]==0 | windows$co2[,"high"]==50000)
idx_data <- setdiff(1:n_time, idx_no_data)
ifirst <- idx_data[1]
idx_data <- c(ifirst-1, idx_data) # start time series 1 earlier for continuity in the figure

  par(mfrow=c(2,1), mai=c(.8, 1.2, .2,.2))

  plot(-data_calib$age, log10(data_calib$co2), pch='x', cex=0.65, xlim=c(-410,0), ylim=c(-0.3,log10(40000)), xlab='', ylab='', xaxs='i', yaxs='i', xaxt='n', yaxt='n')
  grid()
  polygon(-c(time[idx_data],rev(time[idx_data])), log10(c(windows$co2[idx_data,"high"],rev(windows$co2[idx_data,"low"]))), col=rgb(.5,.5,.5,.5), border=1, lty=1)
  points(-data_calib$age, log10(data_calib$co2), pch='x', cex=0.65)
  mtext('Time [Myr ago]', side=1, line=2.1, cex=1.2)
  mtext(expression('CO'[2]*' concentration [ppmv]'), side=2, line=3.5, cex=1.2)
  axis(side=1, at=seq(-450, 0, by=50), labels=c('','400','','300','','200','','100','','0'), cex.axis=1.2)
  ticks=log10(c(seq(1,10,1),seq(10,100,10),seq(200,1000,100),seq(2000,10000,1000),seq(20000,100000,10000)))
  axis(2, at=ticks, labels=rep('',length(ticks)), cex.axis=1.2)
  axis(2, at=log10(c(1,10,100,1000,10000)), labels=c('1','10','100','1000','10000'), las=1, cex.axis=1.2)
  #axis(2, at=log10(c(3,10,30,100,300,1000,3000,10000)), labels=c('3','10','30','100','300','1000','3000','10000'), las=1)
  legend(-410, 0.6, c('Fitted precalibration windows','Data points from Foster et al [2017]'), pch=c(15,4), col=c(rgb(.5,.5,.5,.5),'black'), pt.cex=1.2, cex=1, bty='n', y.intersp=1)
  #lines(-age, log10(model_co2$ctrl[,1]), type='l', lwd=2, col="firebrick")

  plot(-data_calib$age, log10(data_calib$co2), pch='x', cex=0.65, xlim=c(-410,0), ylim=c(-0.3,log10(40000)), xlab='', ylab='', xaxs='i', yaxs='i', xaxt='n', yaxt='n')
  grid()
  polygon(-c(time[idx_data],rev(time[idx_data])), log10(c(windows$co2[idx_data,"high"],rev(windows$co2[idx_data,"low"]))), col=rgb(.5,.5,.5,.5), border=1, lty=1)
  points(-data_calib$age, log10(data_calib$co2), pch='x', cex=0.65)
  mtext('Time [Myr ago]', side=1, line=2.1, cex=1.2)
  mtext(expression('CO'[2]*' concentration [ppmv]'), side=2, line=3.5, cex=1.2)
  axis(side=1, at=seq(-450, 0, by=50), labels=c('','400','','300','','200','','100','','0'), cex.axis=1.2)
  ticks=log10(c(seq(1,10,1),seq(10,100,10),seq(200,1000,100),seq(2000,10000,1000),seq(20000,100000,10000)))
  axis(2, at=ticks, labels=rep('',length(ticks)), cex.axis=1.2)
  axis(2, at=log10(c(1,10,100,1000,10000)), labels=c('1','10','100','1000','10000'), las=1, cex.axis=1.2)
  #axis(2, at=log10(c(3,10,30,100,300,1000,3000,10000)), labels=c('3','10','30','100','300','1000','3000','10000'), las=1)
  legend(-410, 0.6, c('Fitted precalibration windows','Data points from Foster et al [2017]'), pch=c(15,4), col=c(rgb(.5,.5,.5,.5),'black'), pt.cex=1.2, cex=1, bty='n', y.intersp=1)
  lines(-age, log10(model_co2$ctrl[,1]), type='l', lwd=2, col="firebrick")
